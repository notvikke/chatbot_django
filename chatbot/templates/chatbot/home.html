<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vikke's Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Smooth scrolling */
        html { scroll-behavior: smooth; }

        /* Default Light Theme Styles */
        body {
            background-color: white; /* Light background */
            color: #212529; /* Dark text */
            transition: background-color 0.3s, color 0.3s;
        }

        /* Chat bubbles animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }

        /* Chat container styling - Light */
        .chat-container {
            height: 80vh;
            width: 70vw;
            max-width: 900px;
            background-color: #f8f9fa; /* Light grey background */
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1); /* Lighter shadow */
            margin-top: 80px;
            display: flex;
            flex-direction: column;
            border: 1px solid #dee2e6; /* Subtle border for light theme */
        }

        /* Header - Light */
        .chat-header {
            background-color: #e9ecef; /* Lighter header */
            color: #495057; /* Darker grey text */
            padding: 1rem;
            text-align: center;
            font-size: 1.125rem;
            font-weight: 600;
            flex-shrink: 0;
            border-bottom: 1px solid #dee2e6;
        }

        /* Chatbox area - Light */
        .chat-box {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* General message line container (no theme change needed) */
        .message-line {
            display: flex;
            align-items: flex-end;
            gap: 10px;
            max-width: 85%;
        }
        .user-message-line { align-self: flex-end; }
        .bot-message-line { align-self: flex-start; }

        /* Avatar styling - Light */
        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        .user-avatar { background-color: #007bff; color: white; } /* Keep user blue */
        .bot-avatar { background-color: #6c757d; color: white; } /* Medium grey bot avatar */

        /* Message bubble styles - Light */
        .message {
            padding: 10px 14px;
            border-radius: 12px;
            word-wrap: break-word;
        }
        .user-message {
            background-color: #007bff; /* Keep user blue */
            color: white;
            border-bottom-right-radius: 4px;
        }
        .bot-message {
            background-color: #e9ecef; /* Matches header */
            color: #212529; /* Dark text */
            border-bottom-left-radius: 4px;
            border: 1px solid #d6dbe1; /* Subtle border for bot bubble */
        }

        /* Typing Indicator - Light */
        .typing-indicator-container {
             padding: 0 15px 10px 15px;
             flex-shrink: 0;
        }
        #typing-indicator {
            color: #6c757d; /* Medium grey text */
            text-align: left;
            font-size: 0.9em;
        }

        /* Input Area - Light */
        .input-area {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-top: 1px solid #dee2e6; /* Light border */
            flex-shrink: 0;
            background-color: #f8f9fa; /* Match container background */
        }
        #user-input {
            flex: 1;
            background-color: #fff; /* White input */
            color: #495057; /* Dark text */
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid #ced4da; /* Standard input border */
            outline: none;
            margin-right: 0.5rem;
            transition: border-color 0.2s ease;
        }
        #user-input:focus {
             border-color: #86b7fe; /* Blue focus border like Bootstrap */
        }
        .send-button {
            background-color: #007bff; /* Keep blue */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .send-button:hover { background-color: #0056b3; }


        /* Navbar Styling - Light */
        .navbar {
            width: 100%;
            background: #ffffff; /* White navbar */
            display: flex;
            justify-content: center;
            padding: 15px 30px;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Subtle shadow */
            border-bottom: 1px solid #dee2e6;
        }
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1200px;
        }
        .logo {
            font-size: 20px;
            font-weight: bold;
            color: #212529; /* Dark text for logo */
        }
        .nav-buttons { display: flex; gap: 15px; align-items: center; }
        .portfolio-btn { /* Keep blue */
            text-decoration: none; background: #007bff; color: white;
            padding: 8px 15px; border-radius: 5px; transition: background-color 0.3s; font-size: 14px;
        }
        .portfolio-btn:hover { background: #0056b3; }
        #theme-toggle {
            background: none; border: none; font-size: 20px;
            cursor: pointer; color: #495057; /* Dark icon */ padding: 0;
        }


        /* --- Dark Mode Overrides --- */
        body.dark-mode {
            background-color: #121212;
            color: #e0e0e0; /* Slightly off-white */
        }
        .dark-mode .chat-container {
            background-color: #1e1e1e; /* Dark container */
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.5);
            border: 1px solid #333; /* Darker border */
        }
        .dark-mode .chat-header {
            background-color: #2a2a2a;
            color: #e0e0e0;
            border-bottom: 1px solid #333;
        }
        .dark-mode .bot-avatar { background-color: #555; color: white; } /* Dark bot avatar */
         /* Keep user avatar blue */
        .dark-mode .message { color: #e0e0e0; } /* Default dark mode message text */
         /* Keep user message blue/white */
        .dark-mode .bot-message {
            background-color: #383838;
            color: #e0e0e0;
            border: none; /* Remove border in dark mode */
        }
        .dark-mode #typing-indicator { color: #888; } /* Lighter grey */
        .dark-mode .input-area {
            border-top-color: #333;
            background-color: #1e1e1e; /* Match container */
        }
        .dark-mode #user-input {
            background-color: #2a2a2a;
            color: #e0e0e0;
            border: 1px solid #444; /* Subtle border for dark input */
        }
         .dark-mode #user-input:focus {
             border-color: #5a9afa;
        }
        /* Send button remains blue */
        .dark-mode .navbar {
            background: #121212; /* Match body */
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            border-bottom: 1px solid #333;
        }
        .dark-mode .logo { color: #e0e0e0; }
        .dark-mode #theme-toggle { color: #e0e0e0; } /* Light icon */

    </style>
</head>
<body class="flex justify-center items-center h-screen"> <!-- Removed bg-black text-white here, handled by CSS -->

    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-container">
            <span class="logo">Feeling Lonely?</span>
            <div class="nav-buttons">
                <button id="theme-toggle" onclick="toggleTheme()">ðŸŒ™</button>
                <a href="https://notvikke.github.io/portfolio/" target="_blank" class="portfolio-btn">Vikke</a>
            </div>
        </div>
    </nav>

    <!-- Chat Container -->
    <div class="chat-container"> <!-- Removed flex flex-col, handled by internal styles -->
        <!-- Header -->
        <div class="chat-header"> <!-- Use specific class -->
            Ask me anything!
        </div>

        <!-- Chat Messages -->
        <div id="chat-box" class="chat-box">
            <!-- Messages dynamically added here -->
        </div>

        <!-- Typing Indicator -->
        <div class="typing-indicator-container"> <!-- Wrapper for padding -->
             <p id="typing-indicator" style="display: none;">Bot is typing...</p>
        </div>

        <!-- Input Box -->
        <div class="input-area"> <!-- Use specific class -->
            <input id="user-input" type="text" placeholder="Type a message..."
                onkeypress="handleEnter(event)">
            <button onclick="sendMessage()" class="send-button"> <!-- Use specific class -->
                Send
            </button>
        </div>
    </div>

    <script>
        // --- Theme Toggle Functionality ---
        const themeToggleBtn = document.getElementById('theme-toggle');
        const body = document.body;

        // Apply saved theme on load
        if (localStorage.getItem('theme') === 'dark') {
            body.classList.add('dark-mode');
            themeToggleBtn.innerHTML = "â˜€ï¸";
        } else {
            body.classList.remove('dark-mode'); // Ensure light is default
            themeToggleBtn.innerHTML = "ðŸŒ™";
        }

        function toggleTheme() {
            body.classList.toggle('dark-mode');
            if (body.classList.contains('dark-mode')) {
                themeToggleBtn.innerHTML = "â˜€ï¸";
                localStorage.setItem('theme', 'dark');
            } else {
                themeToggleBtn.innerHTML = "ðŸŒ™";
                localStorage.setItem('theme', 'light');
            }
        }

        // --- Chat Functionality ---
        const chatBox = document.getElementById("chat-box");
        const userInputField = document.getElementById("user-input");
        const typingIndicator = document.getElementById("typing-indicator");
        const typingIndicatorContainer = typingIndicator.parentElement; // Get the container


        function sendMessage() {
            const userInput = userInputField.value.trim();
            if (!userInput) return;

            userInputField.value = ""; // Clear input field

            appendMessage("You", userInput, "user-message"); // Display user message

            typingIndicator.style.display = "block"; // Show Typing Indicator
            typingIndicatorContainer.style.display = "block"; // Show container too
            chatBox.scrollTop = chatBox.scrollHeight; // Scroll down

            console.log("Sending message:", userInput); // Debug log

            // Simulate API Fetch (REMOVE/REPLACE with your actual fetch)
            // setTimeout(() => {
            //     const botResponse = `You said: "${userInput}". This is a test response.`;
            //     appendMessage("Bot", botResponse, "bot-message");
            //     typingIndicator.style.display = "none"; // Hide indicator
            //     typingIndicatorContainer.style.display = "none"; // Hide container
            //     console.log("Simulated response received.");
            // }, 1500); // 1.5 second delay


            // Actual Fetch (Uncomment this section)
            fetch("/chatbot/api/", { // MAKE SURE THIS URL IS CORRECT
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message: userInput })
            })
            .then(response => {
                if (!response.ok) {
                     // Try to get error message from response body
                     return response.text().then(text => {
                         throw new Error(`HTTP error ${response.status}: ${text || response.statusText}`);
                     });
                }
                return response.json();
            })
            .then(data => {
                console.log("Received response:", data);
                if (data && data.response) { // Check if data and data.response exist
                    appendMessage("Bot", data.response, "bot-message");
                } else {
                     console.warn("Received data but no response field:", data);
                    appendMessage("Bot", "Sorry, I received an unexpected response.", "bot-message");
                }
            })
            .catch(error => {
                console.error("Fetch Error:", error);
                // Display a user-friendly error, include details from the error object if available
                appendMessage("Bot", `Error: ${error.message || 'Unable to reach the chatbot.'}`, "bot-message");
            })
            .finally(() => {
                typingIndicator.style.display = "none"; // Hide indicator
                typingIndicatorContainer.style.display = "none"; // Hide container
                chatBox.scrollTop = chatBox.scrollHeight; // Scroll down after response/error
            });
        }

        function appendMessage(sender, text, messageClass) {
            // 1. Create the main line container
            const messageLine = document.createElement("div");
            messageLine.classList.add("message-line", "fade-in"); // Base class + animation

            // 2. Create the avatar SPAN element
            const avatarElement = document.createElement("span");
            avatarElement.classList.add("avatar"); // Base avatar style
            avatarElement.setAttribute("aria-hidden", "true"); // Decorative

            // 3. Create the message bubble DIV
            const messageBubble = document.createElement("div");
            messageBubble.classList.add("message", messageClass); // Base + specific bubble style
             // Safely set text content
             messageBubble.textContent = text; // Use textContent for security

            // 4. Configure based on sender and add correct classes/text
            if (messageClass === "user-message") {
                messageLine.classList.add("user-message-line"); // Right alignment class
                avatarElement.classList.add("user-avatar");    // User avatar color
                avatarElement.innerText = "U";                 // User initial
                // Structure: [Bubble] [Avatar]
                messageLine.appendChild(messageBubble);
                messageLine.appendChild(avatarElement);
            } else { // Assuming bot-message
                messageLine.classList.add("bot-message-line"); // Left alignment class
                avatarElement.classList.add("bot-avatar");     // Bot avatar color
                avatarElement.innerText = "B";                 // Bot initial
                // Structure: [Avatar] [Bubble]
                messageLine.appendChild(avatarElement);
                messageLine.appendChild(messageBubble);
            }

            // 5. Append the complete line to the chat box
            chatBox.appendChild(messageLine);

            // 6. Scroll to the bottom to show the new message
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function handleEnter(event) {
            // Send message on Enter key press, but not if Shift is held (for potential future multi-line input)
            if (event.key === "Enter" && !event.shiftKey) {
                event.preventDefault(); // Prevent default action (like form submission or newline)
                sendMessage();
            }
        }

        // Optional: Add a welcome message when the page loads
        // window.addEventListener('DOMContentLoaded', () => {
        //    appendMessage("Bot", "Hello! How can I assist you today?", "bot-message");
        // });

    </script>

</body>
</html>